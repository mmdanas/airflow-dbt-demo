# Airflow DAGs for dbt

> The code in this repository is meant to accompany [this blog post](https://astronomer.io/blog/airflow-dbt-1) on
> beginner and advanced implementation concepts at the intersection of dbt and Airflow.

## To run these DAGs locally:

1. Download the [Astro CLI](https://github.com/astronomer/astro-cli)
2. Download and run [Docker](https://docs.docker.com/docker-for-mac/install/)
3. Clone this repository and `cd` into it.
4. Run `astro dev start` to spin up a local Airflow environment and run the accompanying DAGs on your machine.

## dbt project setup

We are currently using [the jaffle_shop sample dbt project](https://github.com/fishtown-analytics/jaffle_shop). 
The only files required for the Airflow DAGs to run are `dbt_project.yml`, `profiles.yml` and `target/manifest.json`, but we included the models for completeness. If you would like to try these DAGs with your own dbt workflow, feel free to drop in your own project files.


## Notes
- If you make changes to the dbt project, you will need to run `dbt compile` in order to update the `manifest.json` file. 
This may be done manually during development, as part of a CI/CD pipeline, or as a separate step in a production pipeline 
run *before* the Airflow DAG is triggered.
- The sample dbt project contains the `profiles.yml`, which is configured to use environment variables. If the environment variables do not exist, we default to use Astronomer's containerized postgres database. This is **solely for the purpose of this demo**. In a production environment, you should use a production-ready database and use environment variables or some other form of secret management for the database credentials.
- Each DAG runs a `dbt_seed` task at the beginning that loads sample data into the database. This is simply for the purpose of this demo.

[![forthebadge](https://forthebadge.com/images/badges/fuck-it-ship-it.svg)](https://forthebadge.com)
[![forthebadge](https://forthebadge.com/images/badges/made-with-python.svg)](https://forthebadge.com)
[![forthebadge](data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDIuMTMiIGhlaWdodD0iMzUiIHZpZXdCb3g9IjAgMCAyMDIuMTMgMzUiPjxyZWN0IGNsYXNzPSJzdmdfX3JlY3QiIHg9IjAiIHk9IjAiIHdpZHRoPSIxMjcuMjUiIGhlaWdodD0iMzUiIGZpbGw9IiMzMUM0RjMiLz48cmVjdCBjbGFzcz0ic3ZnX19yZWN0IiB4PSIxMjUuMjUiIHk9IjAiIHdpZHRoPSI3Ni44OCIgaGVpZ2h0PSIzNSIgZmlsbD0iIzM4OUFENSIvPjxwYXRoIGNsYXNzPSJzdmdfX3RleHQiIGQ9Ik0xNS43MCAyMkwxNC4yMiAyMkwxNC4yMiAxMy40N0wxNy40OCAxMy40N1ExOC45MSAxMy40NyAxOS43NSAxNC4yMVEyMC41OSAxNC45NiAyMC41OSAxNi4xOEwyMC41OSAxNi4xOFEyMC41OSAxNy40NCAxOS43NyAxOC4xM1ExOC45NSAxOC44MyAxNy40NiAxOC44M0wxNy40NiAxOC44M0wxNS43MCAxOC44M0wxNS43MCAyMlpNMTUuNzAgMTQuNjZMMTUuNzAgMTcuNjRMMTcuNDggMTcuNjRRMTguMjcgMTcuNjQgMTguNjkgMTcuMjdRMTkuMTAgMTYuOTAgMTkuMTAgMTYuMTlMMTkuMTAgMTYuMTlRMTkuMTAgMTUuNTAgMTguNjggMTUuMDlRMTguMjYgMTQuNjggMTcuNTIgMTQuNjZMMTcuNTIgMTQuNjZMMTUuNzAgMTQuNjZaTTI0LjYxIDE4LjAwTDI0LjYxIDE4LjAwTDI0LjYxIDE3LjUyUTI0LjYxIDE2LjI4IDI1LjA1IDE1LjMyUTI1LjQ5IDE0LjM3IDI2LjMwIDEzLjg2UTI3LjEwIDEzLjM1IDI4LjE0IDEzLjM1UTI5LjE5IDEzLjM1IDI5Ljk5IDEzLjg1UTMwLjgwIDE0LjM1IDMxLjI0IDE1LjI5UTMxLjY4IDE2LjIzIDMxLjY4IDE3LjQ4TDMxLjY4IDE3LjQ4TDMxLjY4IDE3Ljk2UTMxLjY4IDE5LjIxIDMxLjI1IDIwLjE2UTMwLjgyIDIxLjEwIDMwLjAxIDIxLjYxUTI5LjIxIDIyLjEyIDI4LjE2IDIyLjEyTDI4LjE2IDIyLjEyUTI3LjEyIDIyLjEyIDI2LjMxIDIxLjYxUTI1LjUwIDIxLjEwIDI1LjA1IDIwLjE3UTI0LjYxIDE5LjIzIDI0LjYxIDE4LjAwWk0yNi4wOSAxNy40NkwyNi4wOSAxNy45NlEyNi4wOSAxOS4zNiAyNi42NCAyMC4xM1EyNy4xOCAyMC45MCAyOC4xNiAyMC45MEwyOC4xNiAyMC45MFEyOS4xNCAyMC45MCAyOS42NyAyMC4xNVEzMC4yMCAxOS40MCAzMC4yMCAxNy45NkwzMC4yMCAxNy45NkwzMC4yMCAxNy41MVEzMC4yMCAxNi4wOSAyOS42NyAxNS4zNFEyOS4xMyAxNC41OCAyOC4xNCAxNC41OEwyOC4xNCAxNC41OFEyNy4xOCAxNC41OCAyNi42NCAxNS4zM1EyNi4xMCAxNi4wOSAyNi4wOSAxNy40NkwyNi4wOSAxNy40NlpNMzcuNTMgMjJMMzUuNTYgMTMuNDdMMzcuMDMgMTMuNDdMMzguMzYgMTkuODhMMzkuOTkgMTMuNDdMNDEuMjMgMTMuNDdMNDIuODQgMTkuODlMNDQuMTUgMTMuNDdMNDUuNjIgMTMuNDdMNDMuNjUgMjJMNDIuMjQgMjJMNDAuNjEgMTUuNzdMMzguOTYgMjJMMzcuNTMgMjJaTTU1LjI3IDIyTDQ5LjcwIDIyTDQ5LjcwIDEzLjQ3TDU1LjIzIDEzLjQ3TDU1LjIzIDE0LjY2TDUxLjE4IDE0LjY2TDUxLjE4IDE3LjAyTDU0LjY4IDE3LjAyTDU0LjY4IDE4LjE5TDUxLjE4IDE4LjE5TDUxLjE4IDIwLjgyTDU1LjI3IDIwLjgyTDU1LjI3IDIyWk02MC45NSAyMkw1OS40NyAyMkw1OS40NyAxMy40N0w2Mi40NyAxMy40N1E2My45NSAxMy40NyA2NC43NSAxNC4xM1E2NS41NSAxNC43OSA2NS41NSAxNi4wNUw2NS41NSAxNi4wNVE2NS41NSAxNi45MCA2NS4xNCAxNy40OFE2NC43MiAxOC4wNiA2My45OSAxOC4zN0w2My45OSAxOC4zN0w2NS45MCAyMS45Mkw2NS45MCAyMkw2NC4zMSAyMkw2Mi42MCAxOC43MUw2MC45NSAxOC43MUw2MC45NSAyMlpNNjAuOTUgMTQuNjZMNjAuOTUgMTcuNTJMNjIuNDggMTcuNTJRNjMuMjMgMTcuNTIgNjMuNjUgMTcuMTVRNjQuMDcgMTYuNzcgNjQuMDcgMTYuMTFMNjQuMDcgMTYuMTFRNjQuMDcgMTUuNDMgNjMuNjggMTUuMDVRNjMuMjkgMTQuNjggNjIuNTIgMTQuNjZMNjIuNTIgMTQuNjZMNjAuOTUgMTQuNjZaTTc1LjUyIDIyTDY5Ljk1IDIyTDY5Ljk1IDEzLjQ3TDc1LjQ4IDEzLjQ3TDc1LjQ4IDE0LjY2TDcxLjQzIDE0LjY2TDcxLjQzIDE3LjAyTDc0LjkzIDE3LjAyTDc0LjkzIDE4LjE5TDcxLjQzIDE4LjE5TDcxLjQzIDIwLjgyTDc1LjUyIDIwLjgyTDc1LjUyIDIyWk04Mi4xNyAyMkw3OS43MiAyMkw3OS43MiAxMy40N0w4Mi4yNCAxMy40N1E4My4zNyAxMy40NyA4NC4yNSAxMy45N1E4NS4xMiAxNC40OCA4NS42MCAxNS40MFE4Ni4wOCAxNi4zMyA4Ni4wOCAxNy41Mkw4Ni4wOCAxNy41Mkw4Ni4wOCAxNy45NVE4Ni4wOCAxOS4xNiA4NS42MCAyMC4wOFE4NS4xMiAyMS4wMCA4NC4yMiAyMS41MFE4My4zMyAyMiA4Mi4xNyAyMkw4Mi4xNyAyMlpNODEuMjAgMTQuNjZMODEuMjAgMjAuODJMODIuMTcgMjAuODJRODMuMzMgMjAuODIgODMuOTYgMjAuMDlRODQuNTggMTkuMzYgODQuNTkgMTcuOTlMODQuNTkgMTcuOTlMODQuNTkgMTcuNTJRODQuNTkgMTYuMTMgODMuOTkgMTUuNDBRODMuMzkgMTQuNjYgODIuMjQgMTQuNjZMODIuMjQgMTQuNjZMODEuMjAgMTQuNjZaTTk5LjY0IDIyTDk2LjUyIDIyTDk2LjUyIDEzLjQ3TDk5LjQ1IDEzLjQ3UTEwMC44OSAxMy40NyAxMDEuNjUgMTQuMDVRMTAyLjQxIDE0LjYzIDEwMi40MSAxNS43OEwxMDIuNDEgMTUuNzhRMTAyLjQxIDE2LjM2IDEwMi4wOSAxNi44M1ExMDEuNzcgMTcuMzAgMTAxLjE2IDE3LjU2TDEwMS4xNiAxNy41NlExMDEuODYgMTcuNzUgMTAyLjIzIDE4LjI2UTEwMi42MSAxOC43OCAxMDIuNjEgMTkuNTFMMTAyLjYxIDE5LjUxUTEwMi42MSAyMC43MSAxMDEuODQgMjEuMzZRMTAxLjA3IDIyIDk5LjY0IDIyTDk5LjY0IDIyWk05OC4wMSAxOC4xNUw5OC4wMSAyMC44Mkw5OS42NSAyMC44MlExMDAuMzUgMjAuODIgMTAwLjc0IDIwLjQ3UTEwMS4xNCAyMC4xMyAxMDEuMTQgMTkuNTFMMTAxLjE0IDE5LjUxUTEwMS4xNCAxOC4xOCA5OS43OCAxOC4xNUw5OS43OCAxOC4xNUw5OC4wMSAxOC4xNVpNOTguMDEgMTQuNjZMOTguMDEgMTcuMDZMOTkuNDYgMTcuMDZRMTAwLjE1IDE3LjA2IDEwMC41NCAxNi43NVExMDAuOTMgMTYuNDMgMTAwLjkzIDE1Ljg2TDEwMC45MyAxNS44NlExMDAuOTMgMTUuMjMgMTAwLjU3IDE0Ljk1UTEwMC4yMSAxNC42NiA5OS40NSAxNC42Nkw5OS40NSAxNC42Nkw5OC4wMSAxNC42NlpNMTA5LjEyIDE4Ljg2TDEwNi4yNiAxMy40N0wxMDcuOTAgMTMuNDdMMTA5Ljg3IDE3LjUxTDExMS44MyAxMy40N0wxMTMuNDcgMTMuNDdMMTEwLjYxIDE4Ljg2TDExMC42MSAyMkwxMDkuMTIgMjJMMTA5LjEyIDE4Ljg2WiIgZmlsbD0iI0ZGRkZGRiIvPjxwYXRoIGNsYXNzPSJzdmdfX3RleHQiIGQ9Ik0xMzguMzYgMjAuOTNMMTM4LjM2IDIwLjkzTDEzOS42NSAxOS40MFExNDAuMzIgMjAuMjcgMTQxLjEwIDIwLjI3TDE0MS4xMCAyMC4yN1ExNDEuMTAgMjAuMjcgMTQxLjExIDIwLjI3TDE0MS4xMSAyMC4yN1ExNDEuNjIgMjAuMjcgMTQxLjg5IDE5Ljk2UTE0Mi4xNiAxOS42NSAxNDIuMTYgMTkuMDVMMTQyLjE2IDE5LjA1TDE0Mi4xNiAxNS40NEwxMzkuMjYgMTUuNDRMMTM5LjI2IDEzLjYwTDE0NC41MiAxMy42MEwxNDQuNTIgMTguOTFRMTQ0LjUyIDIwLjU0IDE0My42OSAyMS4zNlExNDIuODcgMjIuMTcgMTQxLjI4IDIyLjE3TDE0MS4yOCAyMi4xN1ExNDAuMzUgMjIuMTcgMTM5LjYwIDIxLjg1UTEzOC44NCAyMS41MyAxMzguMzYgMjAuOTNaTTE1MS45OCAyMkwxNDkuNjAgMjJMMTQ5LjYwIDEzLjYwTDE1MS45OCAxMy42MEwxNTEuOTggMjJaTTE1OS40OSAyMkwxNTcuMTYgMjJMMTU3LjE2IDEzLjYwTDE1OS4xMSAxMy42MEwxNjIuODIgMTguMDdMMTYyLjgyIDEzLjYwTDE2NS4xNSAxMy42MEwxNjUuMTUgMjJMMTYzLjIwIDIyTDE1OS40OSAxNy41MkwxNTkuNDkgMjJaTTE2OS4yMyAyMC45M0wxNjkuMjMgMjAuOTNMMTcwLjUzIDE5LjQwUTE3MS4yMCAyMC4yNyAxNzEuOTcgMjAuMjdMMTcxLjk3IDIwLjI3UTE3MS45NyAyMC4yNyAxNzEuOTggMjAuMjdMMTcxLjk4IDIwLjI3UTE3Mi41MCAyMC4yNyAxNzIuNzcgMTkuOTZRMTczLjA0IDE5LjY1IDE3My4wNCAxOS4wNUwxNzMuMDQgMTkuMDVMMTczLjA0IDE1LjQ0TDE3MC4xNCAxNS40NEwxNzAuMTQgMTMuNjBMMTc1LjM5IDEzLjYwTDE3NS4zOSAxOC45MVExNzUuMzkgMjAuNTQgMTc0LjU3IDIxLjM2UTE3My43NCAyMi4xNyAxNzIuMTUgMjIuMTdMMTcyLjE1IDIyLjE3UTE3MS4yMiAyMi4xNyAxNzAuNDcgMjEuODVRMTY5LjcxIDIxLjUzIDE2OS4yMyAyMC45M1pNMTgxLjg5IDIyTDE3OS40NyAyMkwxODMuMTggMTMuNjBMMTg1LjUyIDEzLjYwTDE4OS4yNCAyMkwxODYuNzcgMjJMMTg2LjExIDIwLjM3TDE4Mi41NiAyMC4zN0wxODEuODkgMjJaTTE4NC4zMyAxNS45M0wxODMuMjUgMTguNjFMMTg1LjQxIDE4LjYxTDE4NC4zMyAxNS45M1oiIGZpbGw9IiNGRkZGRkYiIHg9IjEzOC4yNSIvPjwvc3ZnPg==)](https://forthebadge.com)
