# Airflow DAGs for dbt

> The code in this repository is meant to accompany [this blog post](https://astronomer.io/blog/airflow-dbt-1) on
> beginner and advanced implementation concepts at the intersection of dbt and Airflow.

## To run these DAGs locally:

1. Download the [Astro CLI](https://github.com/astronomer/astro-cli)
2. Download and run [Docker](https://docs.docker.com/docker-for-mac/install/)
3. Clone this repository and `cd` into it.
4. Run `astro dev start` to spin up a local Airflow environment and run the accompanying DAGs on your machine.

## dbt project setup

We are currently using [the jaffle_shop sample dbt project](https://github.com/fishtown-analytics/jaffle_shop). 
The only files required for the Airflow DAGs to run are `dbt_project.yml`, `profiles.yml` and `target/manifest.json`, but we included the models for completeness. If you would like to try these DAGs with your own dbt workflow, feel free to drop in your own project files.


## Notes
- If you make changes to the dbt project, you will need to run `dbt compile` in order to update the `manifest.json` file. 
This may be done manually during development, as part of a CI/CD pipeline, or as a separate step in a production pipeline 
run *before* the Airflow DAG is triggered.
- The sample dbt project contains the `profiles.yml`, which is configured to use environment variables. If the environment variables do not exist, we default to use Astronomer's containerized postgres database. This is **solely for the purpose of this demo**. In a production environment, you should use a production-ready database and use environment variables or some other form of secret management for the database credentials.
- Each DAG runs a `dbt_seed` task at the beginning that loads sample data into the database. This is simply for the purpose of this demo.

[![forthebadge](data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNTUuMzUiIGhlaWdodD0iMzUiIHZpZXdCb3g9IjAgMCAxNTUuMzUgMzUiPjxyZWN0IGNsYXNzPSJzdmdfX3JlY3QiIHg9IjAiIHk9IjAiIHdpZHRoPSI4OC44NSIgaGVpZ2h0PSIzNSIgZmlsbD0iIzMxQzRGMyIvPjxyZWN0IGNsYXNzPSJzdmdfX3JlY3QiIHg9Ijg2Ljg1IiB5PSIwIiB3aWR0aD0iNjguNSIgaGVpZ2h0PSIzNSIgZmlsbD0iIzM4OUFENSIvPjxwYXRoIGNsYXNzPSJzdmdfX3RleHQiIGQ9Ik0xMy43OCAxOS40MkwxMy43OCAxOS40MkwxNS4yNyAxOS40MlExNS4yNyAyMC4xNSAxNS43NSAyMC41NVExNi4yMyAyMC45NSAxNy4xMiAyMC45NUwxNy4xMiAyMC45NVExNy45MCAyMC45NSAxOC4yOSAyMC42M1ExOC42OCAyMC4zMiAxOC42OCAxOS44MEwxOC42OCAxOS44MFExOC42OCAxOS4yNCAxOC4yOCAxOC45NFExNy44OSAxOC42MyAxNi44NSAxOC4zMlExNS44MiAxOC4wMSAxNS4yMSAxNy42M0wxNS4yMSAxNy42M1ExNC4wNSAxNi45MCAxNC4wNSAxNS43MkwxNC4wNSAxNS43MlExNC4wNSAxNC42OSAxNC44OSAxNC4wMlExNS43MyAxMy4zNSAxNy4wNyAxMy4zNUwxNy4wNyAxMy4zNVExNy45NiAxMy4zNSAxOC42NiAxMy42OFExOS4zNiAxNC4wMSAxOS43NSAxNC42MVEyMC4xNSAxNS4yMiAyMC4xNSAxNS45NkwyMC4xNSAxNS45NkwxOC42OCAxNS45NlExOC42OCAxNS4yOSAxOC4yNiAxNC45MVExNy44NCAxNC41NCAxNy4wNiAxNC41NEwxNy4wNiAxNC41NFExNi4zMyAxNC41NCAxNS45MyAxNC44NVExNS41MyAxNS4xNiAxNS41MyAxNS43MUwxNS41MyAxNS43MVExNS41MyAxNi4xOCAxNS45NiAxNi41MFExNi40MCAxNi44MSAxNy4zOSAxNy4xMFExOC4zOSAxNy40MCAxOC45OSAxNy43OFExOS42MCAxOC4xNiAxOS44OCAxOC42NVEyMC4xNiAxOS4xMyAyMC4xNiAxOS43OUwyMC4xNiAxOS43OVEyMC4xNiAyMC44NiAxOS4zNCAyMS40OVExOC41MiAyMi4xMiAxNy4xMiAyMi4xMkwxNy4xMiAyMi4xMlExNi4yMCAyMi4xMiAxNS40MiAyMS43N1ExNC42NCAyMS40MyAxNC4yMSAyMC44M1ExMy43OCAyMC4yMiAxMy43OCAxOS40MlpNMjUuMjMgMjJMMjMuNjkgMjJMMjYuOTEgMTMuNDdMMjguMjQgMTMuNDdMMzEuNDcgMjJMMjkuOTIgMjJMMjkuMjIgMjAuMDFMMjUuOTIgMjAuMDFMMjUuMjMgMjJaTTI3LjU3IDE1LjI4TDI2LjMzIDE4LjgyTDI4LjgxIDE4LjgyTDI3LjU3IDE1LjI4Wk0zNi45MCAyMkwzNS40MiAyMkwzNS40MiAxMy40N0wzNy4zNCAxMy40N0wzOS44MSAyMC4wMUw0Mi4yNiAxMy40N0w0NC4xOCAxMy40N0w0NC4xOCAyMkw0Mi43MCAyMkw0Mi43MCAxOS4xOUw0Mi44NSAxNS40M0w0MC4zMyAyMkwzOS4yNyAyMkwzNi43NSAxNS40M0wzNi45MCAxOS4xOUwzNi45MCAyMlpNNTAuNDAgMjJMNDguOTIgMjJMNDguOTIgMTMuNDdMNTIuMTggMTMuNDdRNTMuNjEgMTMuNDcgNTQuNDUgMTQuMjFRNTUuMjkgMTQuOTYgNTUuMjkgMTYuMThMNTUuMjkgMTYuMThRNTUuMjkgMTcuNDQgNTQuNDcgMTguMTNRNTMuNjQgMTguODMgNTIuMTYgMTguODNMNTIuMTYgMTguODNMNTAuNDAgMTguODNMNTAuNDAgMjJaTTUwLjQwIDE0LjY2TDUwLjQwIDE3LjY0TDUyLjE4IDE3LjY0UTUyLjk3IDE3LjY0IDUzLjM5IDE3LjI3UTUzLjgwIDE2LjkwIDUzLjgwIDE2LjE5TDUzLjgwIDE2LjE5UTUzLjgwIDE1LjUwIDUzLjM4IDE1LjA5UTUyLjk2IDE0LjY4IDUyLjIyIDE0LjY2TDUyLjIyIDE0LjY2TDUwLjQwIDE0LjY2Wk02NC45MyAyMkw1OS41NyAyMkw1OS41NyAxMy40N0w2MS4wNiAxMy40N0w2MS4wNiAyMC44Mkw2NC45MyAyMC44Mkw2NC45MyAyMlpNNzQuNjMgMjJMNjkuMDYgMjJMNjkuMDYgMTMuNDdMNzQuNTkgMTMuNDdMNzQuNTkgMTQuNjZMNzAuNTQgMTQuNjZMNzAuNTQgMTcuMDJMNzQuMDQgMTcuMDJMNzQuMDQgMTguMTlMNzAuNTQgMTguMTlMNzAuNTQgMjAuODJMNzQuNjMgMjAuODJMNzQuNjMgMjJaIiBmaWxsPSIjRkZGRkZGIi8+PHBhdGggY2xhc3M9InN2Z19fdGV4dCIgZD0iTTEwMi44MyAxNS40OEwxMDAuMjUgMTUuNDhMMTAwLjI1IDEzLjYwTDEwNy43NyAxMy42MEwxMDcuNzcgMTUuNDhMMTA1LjIwIDE1LjQ4TDEwNS4yMCAyMkwxMDIuODMgMjJMMTAyLjgzIDE1LjQ4Wk0xMTguODkgMjJMMTEyLjE0IDIyTDExMi4xNCAxMy42MEwxMTguNzMgMTMuNjBMMTE4LjczIDE1LjQ0TDExNC41MCAxNS40NEwxMTQuNTAgMTYuODVMMTE4LjIzIDE2Ljg1TDExOC4yMyAxOC42M0wxMTQuNTAgMTguNjNMMTE0LjUwIDIwLjE3TDExOC44OSAyMC4xN0wxMTguODkgMjJaTTEyNS41NCAyMkwxMjIuODMgMjJMMTI1Ljg5IDE3Ljc1TDEyMi45NiAxMy42MEwxMjUuNjQgMTMuNjBMMTI3LjMyIDE2LjAyTDEyOC45NyAxMy42MEwxMzEuNTQgMTMuNjBMMTI4LjYxIDE3LjY2TDEzMS43NCAyMkwxMjkuMDAgMjJMMTI3LjI2IDE5LjQwTDEyNS41NCAyMlpNMTM3LjgxIDE1LjQ4TDEzNS4yMyAxNS40OEwxMzUuMjMgMTMuNjBMMTQyLjc1IDEzLjYwTDE0Mi43NSAxNS40OEwxNDAuMTggMTUuNDhMMTQwLjE4IDIyTDEzNy44MSAyMkwxMzcuODEgMTUuNDhaIiBmaWxsPSIjRkZGRkZGIiB4PSI5OS44NSIvPjwvc3ZnPg==)](https://forthebadge.com)
